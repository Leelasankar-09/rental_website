<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Form</title>
    <!-- Custom CSS file link -->
    <link rel="stylesheet" href="payment.css">
    <!-- QRCode.js for client-side QR code generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <form action="/submit-payment" method="POST" id="payment-form">
            <div class="row">
                <div class="col">
                    <h3 class="title"><b>Payment Details</b></h3>

                    <!-- Payment Method Toggle -->
                    <div class="inputBox payment-method">
                        <label>Choose Payment Method:</label>
                        <div class="method-toggle">
                            <input type="radio" name="payment-method" id="card-method" value="card" checked>
                            <label for="card-method">Credit/Debit Card</label>
                            <input type="radio" name="payment-method" id="upi-method" value="upi">
                            <label for="upi-method">UPI</label>
                        </div>
                    </div>

                    <!-- Card Payment Section -->
                    <div class="payment-section" id="card-section">
                        <div class="inputBox">
                            <label for="card-types">Cards Accepted:</label>
                            <img src="./assets/card_img.png" alt="Accepted payment cards (Visa, MasterCard, etc.)">
                        </div>
                        <div class="inputBox">
                            <label for="card-name">Name on Card:</label>
                            <input type="text" id="card-name" placeholder="John Doe" required>
                        </div>
                        <div class="inputBox">
                            <label for="card-number">Credit Card Number:</label>
                            <input type="text" id="card-number" placeholder="1111 2222 3333 4444" pattern="[0-9\s]{13,19}" required>
                        </div>
                        <div class="inputBox">
                            <label for="exp-month">Expiration Month:</label>
                            <input type="text" id="exp-month" placeholder="January" required>
                        </div>
                        <div class="flex">
                            <div class="inputBox">
                                <label for="exp-year">Expiration Year:</label>
                                <input type="number" id="exp-year" placeholder="2025" min="2025" required>
                            </div>
                            <div class="inputBox">
                                <label for="cvv">CVV:</label>
                                <input type="text" id="cvv" placeholder="123" pattern="[0-9]{3,4}" required>
                            </div>
                        </div>
                    </div>

                    <!-- UPI Payment Section -->
                    <div class="payment-section" id="upi-section" style="display: none;">
                        <div class="inputBox">
                            <label for="bill-amount">Bill Amount (₹):</label>
                            <input type="number" id="bill-amount" placeholder="Enter amount (e.g., 500)" step="0.01" min="1" required>
                        </div>
                        <div class="inputBox">
                            <label for="upi-id">UPI ID (VPA, optional):</label>
                            <input type="text" id="upi-id" placeholder="yourname@upi" pattern="[a-zA-Z0-9.\-_]{2,256}@[a-zA-Z]{2,64}" title="Enter a valid UPI ID (e.g., yourname@upi)">
                        </div>
                        <div class="inputBox">
                            <label>Scan QR Code to Pay:</label>
                            <div id="upi-qr-code"></div>
                            <p class="upi-help">Scan with PhonePe, Google Pay, or any UPI app to pay instantly.</p>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="submit-btn">Proceed to Checkout</button>
        </form>
    </div>

    <!-- JavaScript for toggling payment methods and instant QR code -->
    <script>
        // Toggle payment methods
        const cardMethod = document.getElementById('card-method');
        const upiMethod = document.getElementById('upi-method');
        const cardSection = document.getElementById('card-section');
        const upiSection = document.getElementById('upi-section');
        const billAmountInput = document.getElementById('bill-amount');
        const qrCodeDiv = document.getElementById('upi-qr-code');

        cardMethod.addEventListener('change', () => {
            cardSection.style.display = 'block';
            upiSection.style.display = 'none';
            toggleRequired(cardSection, true);
            toggleRequired(upiSection, false);
        });

        upiMethod.addEventListener('change', () => {
            cardSection.style.display = 'none';
            upiSection.style.display = 'block';
            toggleRequired(cardSection, false);
            toggleRequired(upiSection, true);
            updateQRCode(); // Generate QR code on UPI selection
        });

        function toggleRequired(section, required) {
            const inputs = section.querySelectorAll('input:not([id="upi-id"])'); // UPI ID is optional
            inputs.forEach(input => {
                input.required = required;
            });
        }

        // Instant QR code generation
        const merchantVPA = 'merchant@upi'; // Replace with your actual VPA
        const merchantName = 'Your Business'; // Replace with your business name

        function updateQRCode() {
            const amount = parseFloat(billAmountInput.value);
            if (amount >= 1) {
                const transactionId = 'TXN' + Date.now(); // Unique transaction ID
                const upiUrl = `upi://pay?pa=${encodeURIComponent(merchantVPA)}&pn=${encodeURIComponent(merchantName)}&am=${amount.toFixed(2)}&cu=INR&tn=Payment%20for%20Bill&tr=${transactionId}`;

                // Clear previous QR code
                qrCodeDiv.innerHTML = '';

                // Generate new QR code
                new QRCode(qrCodeDiv, {
                    text: upiUrl,
                    width: 150,
                    height: 150,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                });
            } else {
                qrCodeDiv.innerHTML = '<p class="upi-help">Enter a valid amount (₹1 or more) to generate QR code.</p>';
            }
        }

        // Update QR code instantly on bill amount change
        billAmountInput.addEventListener('input', updateQRCode);

        // Initial state (no QR code until amount is entered)
        qrCodeDiv.innerHTML = '<p class="upi-help">Enter bill amount to generate QR code.</p>';

        // Generate QR code if amount is pre-filled on UPI selection
        if (billAmountInput.value) {
            updateQRCode();
        }
    </script>
</body>
</html>